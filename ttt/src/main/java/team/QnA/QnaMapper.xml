<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper

PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="team.QnA.QnaDao"> <!--이 sql 문장과 매핑될 인터페이스의 완전한 경로-->

	<insert id="save" parameterType="team.QnA.QnaVo">
		insert into qna
		values ( board_seq.nextval, #{title}, #{author}, #{qcontents}, sysdate ,
		#{ref},#{pwd})
	</insert>

	<select id="Recent" resultType="team.QnA.QnaVo">
		select * from qna where num=(select max(num) from
		(select * from qna where author=#{author}))
	</select>

	<select id="List" resultType="team.QnA.QnaVo">
		select
		"NUM","TITLE","AUTHOR","QCONTENTS","BDATE","PAGE","ROWNUM","QREF","TOTALPAGES"
		from(
		select num, title,author,qcontents,bdate,FLOOR((rownum-1)/10+1)
		page,rownum,qref,ceil(count(*) over()/10) totalpages from
		(
		select num,lpad('└',(level-1)*3,' ')||title
		title,author,qcontents,bdate,qref,rownum from
		(select num, title,author,qcontents,bdate,rownum,qref from qna)
		start with qref=0 connect by prior num=qref
		order SIBLINGS by num desc
		)
		)where page=1
	</select>

	<select id="getPage" parameterType="int" resultMap="qnaMap">
		select NUM,TITLE,AUTHOR,QCONTENTS,BDATE,PAGE,ROWNUM,QREF,TOTALPAGES from(
		select num, title,author,qcontents,bdate,FLOOR((rownum-1)/10+1)
		page,rownum,qref,ceil(count(*) over()/10) totalpages from
		(
		select num,lpad('└',(level-1)*3,' ')||title
		title,author,qcontents,bdate,qref,rownum from
		(select num, title,author,qcontents,bdate,rownum,qref from qna)
		start with qref=0 connect by prior num=qref
		)
		)where page=#{ pgnum }
	</select>
	
	   <select id="Find" resultType="team.QnA.QnaVo">
		select NUM,TITLE,AUTHOR,QCONTENTS,BDATE,PAGE,ROWNUM,QREF,TOTALPAGES from(
		select num, title,author,qcontents,bdate,FLOOR((rownum-1)/10+1)
		page,rownum,qref,ceil(count(*) over()/10) totalpages from
		(
		select num,lpad('└',(level-1)*3,' ')||title
		title,author,qcontents,bdate,qref,rownum from
		(select num, title,author,qcontents,bdate,rownum,qref from qna)
		where ${category} like '%'||#{keyword}||'%'
		start with qref=0 connect by prior num=qref
		)
		)where page=#{pgnum}
	</select>
	
	

	<resultMap id="qnaMap" type="team.QnA.Qna">
		<result property="page" column="page" />
		<result property="totalpages" column="totalpages" />

		<collection property="list" column="num" javaType="ArrayList"
			ofType="team.QnA.QnaVo">
			<id property="num" column="num" />
			<result property="title" column="title" />
			<result property="qcontents" column="qcontents" />
			<result property="author" column="author" />
			<result property="ref" column="ref" />
		</collection>
	</resultMap>

 	<select id="Read" resultType="team.QnA.QnaVo">
		select * from qna where num=#{num}
	</select>

	<!-- <select id="Find" resultType="team.QnA.QnaVo">
		SELECT * FROM qna WHERE
		<if test="category=='title'">
			title LIKE '%'||#{keyword}||'%'
		</if>
		<if test="category=='author'">
			author LIKE '%'||#{keyword}||'%'
		</if>
		<if test="category=='contents'">
			qcontents LIKE '%'||#{keyword}||'%'
		</if>
	</select>    -->
	
	<update id="Modify" parameterType="team.QnA.QnaVo">
		update qna set title=#{title},author=#{author}, qcontents=#{qcontents}
		where num=#{num}
	</update>

	<delete id="Delete" >
        delete from qna where num=#{num}
    </delete>
    
</mapper>
    




