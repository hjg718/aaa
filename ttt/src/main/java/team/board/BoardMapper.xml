<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--이 sql 문장과 매핑될 인터페이스의 완전한 경로 -->
<mapper namespace="team.board.BoardDAO"> 
	<!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ -->
	<resultMap id="empMap" type="team.board.Board">
		<result property="currpage" column="currpage" />
		<result property="totalpage" column="totalpage"/>
		<collection property="list" column="num" javaType="ArrayList" 
								ofType="team.board.BoardVO">
			<id property="num" column="num" /><!-- pk로 사용되는건 id로 쓴다. -->
			<result property="title" column="title" />
			<result property="contents" column="contents" />
			<result property="author" column="author" />
			<result property="regdate" column="regdate" />
			<result property="ref" column="ref" />
		</collection>
		
	</resultMap>
<!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ -->
	<select id="boardPage" parameterType="int" resultMap="empMap">
    	    SELECT num,title,contents,author,currpage,totalpage FROM 
       (
          SELECT T1.*, FLOOR((ROWNUM-1)/7+1) currpage, CEIL(COUNT(*) OVER()/7) totalpage
		  FROM 
          	(
            	SELECT num, LPAD('└',(LEVEL-1)*2,'　')||title title, author, contents 
             	FROM fboard
             	START WITH ref=0  
             	CONNECT BY PRIOR num=ref
             	             	 
          	) T1 
       ) where currpage = #{pageNum}
       
    </select>
<!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ -->

<!-- 제목 클릭시 내용 보여주기 -->
	<select id="info" resultType="team.board.BoardVO">
		select num,title,contents,author,regdate from fboard where num=#{num}
	</select>
	<!-- 수정 -->
	<update id="update" parameterType="team.board.BoardVO">
		update fboard set title=#{title},contents=#{contents} where num=#{num}
	</update>
	<!-- 삭제 -->
	<delete id="delete">
		delete from fboard where num=#{num} and not exists
			(
				select * from fboard where ref=#{num}
			)
	</delete>
	<!-- 글쓰기 -->
	<insert id="input" parameterType="team.board.BoardVO">
		insert into fboard (num, title, contents,author,regdate,ref) 
		values (BOARD_SEQ.NEXTVAL, #{title}, #{contents}, #{author} ,sysdate,#{ref} )
	</insert> 
	<!-- 검색 -->
	<select id="search" resultType="team.board.BoardVO">
		 select * from fboard where 
        	<if test="category == 'num' ">
        		num = #{keyword}
        	</if>
        	
        	<if test="category == 'title' ">
        		title like '%' ||  #{keyword} || '%'

        	</if>
        	
        	<if test="category == 'author' ">
        		author like  '%'||#{keyword}||'%'
        	</if>
	</select>
	
	
</mapper>